<html>
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<body>
	<h1>Lokale Systeme</h1>
	<h2>Raspberry Pi Dienste:</h2>
	<div class="parent">
		<div class="status-circle" id="192.168.178.38:9100"></div><a style="font-size: 1.2rem;" href="http://pihole.pi"
			target="_blank">Pi-hole</a><span> - </span><a href="http://192.168.178.38:9100/admin/"
			target="_blank">(Alternativ)</a>
	</div>
	<div class="parent">
		<div class="status-circle" id="192.168.178.38:8080"></div><a style="font-size: 1.2rem;"
			href="http://homematic.pi" target="_blank">Homematic</a><span> - </span><a href="http://192.168.178.38:8080"
			target="_blank">(Alternativ)</a>
	</div>
	<div class="parent">
		<div class="status-circle" id="192.168.178.38:9000"></div><a style="font-size: 1.2rem;"
			href="http://portainer.pi" target="_blank">Docker Management</a><span> - </span><a href="http://192.168.178.38:9000/"
			target="_blank">(Alternativ)</a>
	</div>
	<h2>Ger√§te:</h2>
	<div class="parent">
		<div class="status-circle" id="192.168.178.1:80"></div><a style="font-size: 1.2rem;" href="http://fritz.box"
			target="_blank">Fritz Box</a><span> - </span>
		<a href="http://192.168.178.1" target="_blank">(Alternativ)</a>
	</div>
	<div class="parent">
		<div class="status-circle" id="192.168.178.54:80"></div><a style="font-size: 1.2rem;"
			href="http://fritz.repeater" target="_blank">Repeater</a><span> - </span><a href="http://192.168.178.54"
			target="_blank">(Alternativ)</a>
	</div>
	<div class="parent">
		<div class="status-circle" id="192.168.178.20:80"></div><a style="font-size: 1.2rem;"
			href="http://192.168.178.20" target="_blank">Drucker</a>
	</div>
	<div style="margin-top: 1.5rem;">Zuletzt aktualisiert: <span id="timestamp">Nie</span></div>
	<button onclick="fetchStatus(true)">Aktualisieren</button>
	<script>
		const hostList = ["192.168.178.38:9100", "192.168.178.38:8080", "192.168.178.38:9000", "192.168.178.1:80", "192.168.178.54:80", "192.168.178.20:80"]
		const red = "#d6320d"
		const green = "#2dad38"

		function formatTimeStamp(jsonData) {
			var yearAndTimeArr = JSON.stringify(jsonData.timestamp).split("T")
			return yearAndTimeArr[1].split("+")[0].split(".")[0] + " Uhr - " + yearAndTimeArr[0].substring(1)
		}

		function updateHtml(jsonData) {
			if (jsonData.data == null) {
				console.log("Check not ready");
				return;
			}
			for (let i = 0; i < hostList.length; i++) {
				if (jsonData.data.find(item => item.host == hostList[i]).status === "UP") {
					document.getElementById(hostList[i]).style.backgroundColor = green
				} else if (jsonData.data.find(item => item.host == hostList[i]).status === "DOWN") {
					document.getElementById(hostList[i]).style.backgroundColor = red
				}
			}

			const timeStamp = new Date(jsonData.timestamp);
			const tsNow = Date.now();

			var diff = tsNow.valueOf() - timeStamp.valueOf();
			var differenceString = ""
			if (diff > 60e3) {
				differenceString = Math.floor(diff / 60e3) + 'min'
			}
			else {
				differenceString = Math.floor(diff / 1e3) + 's'
			}

			if (differenceString === "0s" || differenceString === "1s") {
				document.getElementById("timestamp").innerHTML = "jetzt"
			} else {
				document.getElementById("timestamp").innerHTML = "vor " + differenceString + "     (" + formatTimeStamp(jsonData) + ")"
			}
		}

		function fetchStatus(fetchInstant) {
			//let url = "http://127.0.0.1:8081/status"
			let url = "http://" + window.location.host + "/status"
			if (fetchInstant) {
				url = url + "/now"
			}

			fetch(url)
				.then(res => res.json())
				.then(function(out) {
					updateHtml(out)
				}).catch(err => { throw err });

		}
		window.addEventListener('load', function() {
			fetchStatus(false);
			// Your document is loaded.
			var fetchInterval = 5000; // 5 seconds.

			// Invoke the request every 5 seconds.
			setInterval(fetchStatus, fetchInterval);
		});
	</script>
</body>

<style>
	span {
		white-space: pre;
	}

	.parent {
		display: flex;
		margin-top: 0.5rem;
		margin-bottom: 0.5rem;
		align-items: center;
	}

	.status-circle {
		background-color: gray;
		border-radius: 100px;
		border: solid 2px black;
		height: 20px;
		width: 20px;
		margin-right: 0.5rem;
		display: inline-block;
	}
</style>


</html>